---
title: "Run_Analysis"
format: html
---


```{r}
# Load all functions
source("./src/Source_Everything.R")


# List of needed packages
packages <- c(
  "diann",           # to extract the MaxLFQ matrix from DIANN report
  "arrow",           # to read the report.parquet file
  "here",            # to avoid the need for use the path while loading the data
  "tidyverse",       # to do the data wrangling, plots, etc...
  "janitor",         # to clean the column names
  "ggpointdensity",  # to reconstruct the m/z density map
  "naniar",          # for sparsity analysis
  "factoextra",      # to plot the PCA
  "patchwork",       # to combine plots
  "lsa",             # to calculate the cosine similarity
  "ggvenn",          # to plot the Venn diagram
  "paletteer",       # to use the nice color palette
  "ggtext",          # to provide Markdown and HTML formatting in ggplot2
  "ggrepel",         # to avoid the overlapping of the labels in the plots
  "kableExtra",      # to format the tables
  "limma",           # to calculate the differential abundance
  "DIAgui"           # (no comment provided)
)

Install_Packages(packages)
```



```{r}
  samples <- c(
    P2_01 =  "NaCl_REP_1",
    P2_02 = "NaCl_REP_2",
    P2_03 =  "NaCl_REP_3",
    
    P2_04 = "Actinonin_15mg_REP_1",
    P2_05 =  "Actinonin_15mg_REP_2",
    P2_06 = "Actinonin_15mg_REP_3",
    P1_04 = "Actinonin_30mg_REP_1",
    P1_05 =  "Actinonin_30mg_REP_2",
    
    P2_11 = "JPM_OEt_50mg_REP_1",
    P2_12 =  "JPM_OEt_50mg_REP_2",
    P1_10 =  "JPM_OEt_100mg_REP_1",
    P1_11 = "JPM_OEt_100mg_REP_2",
    P1_12 =  "JPM_OEt_100mg_REP_3",
    
    P1_02 = "Venom_REP_1",
    P1_03 =  "Venom_REP_2",
    
    P2_07 =  "Ven_e_Actn_15mg_REP_1",
    P2_08 = "Ven_e_Actn_15mg_REP_2",
    P2_09 =  "Ven_e_Actn_15mg_REP_3",
    
    P1_07 = "Ven_e_Actn_30mg_REP_1",
    P1_08 =  "Ven_e_Actn_30mg_REP_2",
    P1_09 = "Ven_e_Actn_30mg_REP_3",
    
    P2_13 = "Ven_e_JPMOEt_50mg_REP_1",
    P2_14 =  "Ven_e_JPMOEt_50mg_REP_2",
    P2_15 = "Ven_e_JPMOEt_50mg_REP_3",
    
    P1_13 = "Ven_e_JPMOEt_100mg_REP_1",
    P1_14 =  "Ven_e_JPMOEt_100mg_REP_2",
    P1_15 = "Ven_e_JPMOEt_100mg_REP_3"
  )
  
  Check_SampleName(samples)
  # organism = "MOUSE"
  # parquetDIR <- "./data/input/report.parquet"
  # rdsDIR <- "./data/temp_files/diannReport.rds"

  labels_names <- c(
   "NaCl_REP_1" = "NaCl r1",
   "NaCl_REP_2" = "NaCl r2",
   "NaCl_REP_3" = "NaCl r3",
   
   "Actinonin_15mg_REP_1" = "Actinonin 15mg r1",
   "Actinonin_15mg_REP_2" = "Actinonin 15mg r2",
   "Actinonin_15mg_REP_3" = "Actinonin 15mg r3",
   
   "Actinonin_30mg_REP_1" = "Actinonin 30mg r1",
   "Actinonin_30mg_REP_2" = "Actinonin 30mg r2",
   
   "JPM_OEt_50mg_REP_1" = "JPMOEt 50mg r1",
   "JPM_OEt_50mg_REP_2" = "JPMOEt 50mg r2",
   
   "JPM_OEt_100mg_REP_1" = "JPMOEt 100mg r1",
   "JPM_OEt_100mg_REP_2" = "JPMOEt 100mg r2",
   "JPM_OEt_100mg_REP_3" = "JPMOEt 100mg r3",
   
   "Venom_REP_1" = "Venom r1",
   "Venom_REP_2" = "Venom r2",
   
   "Ven_e_Actn_15mg_REP_1" = "Venom + Actinonin 15mg r1",
   "Ven_e_Actn_15mg_REP_2" = "Venom + Actinonin 15mg r2",
   "Ven_e_Actn_15mg_REP_3" = "Venom + Actinonin 15mg r3",
   
   "Ven_e_Actn_30mg_REP_1" = "Venom + Actinonin 30mg r1",
   "Ven_e_Actn_30mg_REP_2" = "Venom + Actinonin 30mg r2",
   "Ven_e_Actn_30mg_REP_3" = "Venom + Actinonin 30mg r3",
   
   "Ven_e_JPMOEt_50mg_REP_1" = "Venom + JPMOEt 50mg r1",
   "Ven_e_JPMOEt_50mg_REP_2" = "Venom + JPMOEt 50mg r2",
   "Ven_e_JPMOEt_50mg_REP_3" = "Venom + JPMOEt 50mg r3",
   
   "Ven_e_JPMOEt_100mg_REP_1" = "Venom + JPMOEt 100mg r1",
   "Ven_e_JPMOEt_100mg_REP_2" = "Venom + JPMOEt 100mg r2",
   "Ven_e_JPMOEt_100mg_REP_3" = "Venom + JPMOEt 100mg r3"
  )
  
  
  colors = c(
    "#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99",
    "#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a")
```


```{r}

  Check_SampleName(samples)

  dr <- Generate_DiannReport(samples, organism = "MOUSE")
  
  precursorRT <- Generate_Graph_PrecursorRT(dr, colors)
  
  ggplot2::ggsave(
    filename = paste0("Precursor_x_RT", ".png"),
    path = "./data/output/",
    plot = precursorRT,
    width = 210, height = 297, # A4
    units = "mm", dpi = 300
  )

  ionCloud <- Generate_IonCloud(dr)
  
    ggplot2::ggsave(
    filename = paste0("ionCloud", ".png"),
    path = "./data/output/",
    plot = ionCloud,
    width = 210, height = 297, # A4
    units = "mm", dpi = 300
  )
```

